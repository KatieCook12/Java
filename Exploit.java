import java.io.*;

// Defines the 'Exploit' class that implements Serializable.
public class Exploit implements Serializable {

    // Creates a private method for custom deserialization.
    private void readObject(ObjectInputStream in){

        // Tries...
        try {

            // Prints a message to indicate that the object is exploiting the deserialization process.
            System.out.println("Hi, I've exploited the deserialization process.");
        }
        catch (Exception e) {

            // If an error occurs during deserialization, an exception message is printed.
            System.out.println("Exception: " + e.toString());
        }
    }

    // This method defines how to serialise an object to a file.
    public static void serializeToFile(Object obj, String filename){

        // Tries...
        try {

            // Creates a FileOutputStream with the specified filename to write to.
            FileOutputStream file = new FileOutputStream(filename);

            // Constructs an ObjectOutputStream in order to serialise the object.
            ObjectOutputStream out = new ObjectOutputStream(file);

            // Prints a message indicating that the serialisation process has begun.
            System.out.println("Serializing " + obj.toString() + " to " + filename);

            // The object is written to the 'ObjectOutputStream'.
            out.writeObject(obj);

            // Closes the 'ObjectOutputStream' and the 'FileOutputStream'.
            out.close();
            file.close();
        }
        catch (Exception e) {

            // If an error occurs during serialisation, this function prints an exception message.
            System.out.println("Exception: " + e.toString());
        }
    }

    // Program's main method.
    public static void main(String args[]){

        // Initialises a new instance of the 'Exploit' class.
        Exploit exploit = new Exploit();

        // Defines the serialised object's filename.
        String file = "Exp.ser";

        // Serialise the object to the specified file, use the 'serializeToFile' method.
        serializeToFile(exploit, file);
    }
}
